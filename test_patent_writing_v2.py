"""
æµ‹è¯• Gemini ä¸“åˆ©æ’°å†™åŠŸèƒ½ - å®Œæ•´ç‰ˆ

æä¾›å®Œæ•´ä¿¡æ¯æ¥ç”Ÿæˆä¸“åˆ©ç”³è¯·æ–‡ä»¶
"""

import asyncio
import os
from dotenv import load_dotenv
from datetime import datetime

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv('/Users/zhangyanlong/workspaces/openai-agents-python/.env')

from main_agent import patent_agent
from agents import Runner


async def test_writing_complete():
    """æµ‹è¯•å®Œæ•´çš„ä¸“åˆ©æ’°å†™"""
    print("=" * 60)
    print("ğŸ”¬ Gemini ä¸“åˆ©æ’°å†™åŠŸèƒ½æµ‹è¯•ï¼ˆå®Œæ•´ç‰ˆï¼‰")
    print("=" * 60)

    # æ£€æŸ¥ API é…ç½®
    api_key = os.getenv("GOOGLE_API_KEY")
    if not api_key:
        print("âŒ é”™è¯¯ï¼šæœªè®¾ç½® GOOGLE_API_KEY ç¯å¢ƒå˜é‡")
        print("è¯·è®¾ç½®ï¼šexport GOOGLE_API_KEY='your_api_key'")
        return

    print(f"âœ“ API å¯†é’¥å·²é…ç½®ï¼š{api_key[:10]}...")

    # å®Œæ•´çš„ä¸“åˆ©æ’°å†™è¯·æ±‚
    prompt = """
    è¯·æ’°å†™ä¸€ä»½å®Œæ•´çš„å‘æ˜ä¸“åˆ©ç”³è¯·æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ‰€æœ‰ç« èŠ‚ï¼š

    ## å‘æ˜ä¿¡æ¯
    - å‘æ˜åç§°ï¼šåŸºäºæ·±åº¦å­¦ä¹ çš„æ™ºèƒ½æ¨èç³»ç»Ÿ
    - æŠ€æœ¯é¢†åŸŸï¼šäººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€æ•°æ®æŒ–æ˜
    - ç”³è¯·äººï¼šå¼ ä¸‰ç§‘æŠ€æœ‰é™å…¬å¸
    - å‘æ˜äººï¼šæå››

    ## å‘æ˜æè¿°
    1. èƒŒæ™¯æŠ€æœ¯ï¼š
       - ç°æœ‰æ¨èç³»ç»Ÿä¸»è¦åŸºäºååŒè¿‡æ»¤å’Œå†…å®¹è¿‡æ»¤
       - å­˜åœ¨çš„é—®é¢˜ï¼šå†·å¯åŠ¨é—®é¢˜ã€æ¨èå‡†ç¡®ç‡æœ‰é™ã€æ— æ³•æ•æ‰ç”¨æˆ·å…´è¶£åŠ¨æ€å˜åŒ–
       - ä¼ ç»Ÿæ–¹æ³•éš¾ä»¥å¤„ç†å¤§è§„æ¨¡ç”¨æˆ·å’Œç‰©å“æ•°æ®

    2. è¦è§£å†³çš„æŠ€æœ¯é—®é¢˜ï¼š
       - æé«˜æ¨èå‡†ç¡®ç‡
       - è§£å†³å†·å¯åŠ¨é—®é¢˜
       - æ•æ‰ç”¨æˆ·å…´è¶£çš„åŠ¨æ€å˜åŒ–
       - å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„é«˜æ•ˆæ€§

    3. æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼š
       - é‡‡ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¶æ„
       - ç»“åˆåµŒå…¥å±‚ã€éšè—å±‚å’Œè¾“å‡ºå±‚
       - èåˆååŒè¿‡æ»¤å’Œå†…å®¹æ¨èæŠ€æœ¯
       - å®æ—¶å­¦ä¹ ç”¨æˆ·åé¦ˆ

    4. æœ‰ç›Šæ•ˆæœï¼š
       - æ¨èå‡†ç¡®ç‡æå‡30%ä»¥ä¸Š
       - æœ‰æ•ˆè§£å†³å†·å¯åŠ¨é—®é¢˜
       - æå‡ç”¨æˆ·æ»¡æ„åº¦å’Œè½¬åŒ–ç‡
       - è®¡ç®—æ•ˆç‡æå‡50%

    5. é™„å›¾è¯´æ˜ï¼š
       - å›¾1ï¼šç³»ç»Ÿæ•´ä½“æ¶æ„å›¾
       - å›¾2ï¼šç¥ç»ç½‘ç»œç»“æ„å›¾
       - å›¾3ï¼šæ¨èæµç¨‹å›¾

    6. å…·ä½“å®æ–½æ–¹å¼ï¼š
       - è¯¦ç»†æè¿°ç³»ç»Ÿå„æ¨¡å—
       - ç¥ç»ç½‘ç»œè®­ç»ƒæ–¹æ³•
       - å®æ—¶å­¦ä¹ æœºåˆ¶

    7. æƒåˆ©è¦æ±‚ä¹¦ï¼š
       - ç‹¬ç«‹æƒåˆ©è¦æ±‚ï¼ˆ1é¡¹ï¼‰
       - ä»å±æƒåˆ©è¦æ±‚ï¼ˆ5é¡¹ï¼‰

    è¯·æŒ‰æ ‡å‡†ä¸“åˆ©ç”³è¯·æ ¼å¼æ’°å†™ï¼ŒåŒ…å«å®Œæ•´çš„å‘æ˜åç§°ã€æŠ€æœ¯é¢†åŸŸã€èƒŒæ™¯æŠ€æœ¯ã€å‘æ˜å†…å®¹ã€é™„å›¾è¯´æ˜ã€å…·ä½“å®æ–½æ–¹å¼å’Œæƒåˆ©è¦æ±‚ä¹¦ã€‚
    """

    print("\nğŸ“ æ­£åœ¨ç”Ÿæˆå®Œæ•´çš„ä¸“åˆ©ç”³è¯·æ–‡ä»¶...")
    print("-" * 60)

    result = await Runner.run(patent_agent, prompt)

    # ä¿å­˜ç»“æœ
    output = result.final_output
    print("\n" + "=" * 60)
    print("ğŸ“„ ç”Ÿæˆç»“æœé¢„è§ˆï¼ˆå‰1000å­—ç¬¦ï¼‰")
    print("=" * 60)
    print(output[:1000] + "..." if len(output) > 1000 else output)

    # ä¿å­˜åˆ°æ–‡ä»¶
    with open("patent_writing_complete_result.txt", "w", encoding="utf-8") as f:
        f.write("Gemini ä¸“åˆ©æ’°å†™å®Œæ•´æµ‹è¯•ç»“æœ\n")
        f.write("=" * 60 + "\n\n")
        f.write(f"æµ‹è¯•æ—¶é—´ï¼š{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        f.write(f"API å¯†é’¥ï¼š{api_key[:10]}...\n\n")
        f.write("å®Œæ•´è¯·æ±‚ï¼š\n")
        f.write("-" * 60 + "\n")
        f.write(prompt.strip() + "\n\n")
        f.write("=" * 60 + "\n\n")
        f.write("ç”Ÿæˆç»“æœï¼š\n")
        f.write("-" * 60 + "\n")
        f.write(output)
        f.write("\n\n" + "=" * 60 + "\n")
        f.write(f"ç»“æœé•¿åº¦ï¼š{len(output)} å­—ç¬¦\n")
        f.write("æµ‹è¯•çŠ¶æ€ï¼šâœ… æˆåŠŸ\n")

    print(f"\nâœ… æµ‹è¯•å®Œæˆï¼")
    print(f"ğŸ“Š ç»“æœç»Ÿè®¡ï¼š")
    print(f"   - è¾“å‡ºé•¿åº¦ï¼š{len(output)} å­—ç¬¦")
    print(f"   - è¡Œæ•°ï¼š{output.count(chr(10))} è¡Œ")
    print(f"ğŸ’¾ è¯¦ç»†ç»“æœå·²ä¿å­˜åˆ°ï¼špatent_writing_complete_result.txt")
    print("=" * 60)


if __name__ == "__main__":
    asyncio.run(test_writing_complete())
